      logoGroup.style.display = 'none';
      logoImage.removeAttribute('href');
    });

    // Drag para reposicionar logo
    let dragging = false; let offset = {x:0,y:0};
    function pointFromEvent(evt){
      const pt = svg.createSVGPoint();
      const ctm = svg.getScreenCTM();
      pt.x = (evt.touches? evt.touches[0].clientX : evt.clientX);
      pt.y = (evt.touches? evt.touches[0].clientY : evt.clientY);
      const inv = ctm.inverse();
      const sp = pt.matrixTransform(inv);
      return {x: sp.x, y: sp.y};
    }
    logoImage.addEventListener('pointerdown', (e)=>{
      dragging = true; logoImage.setPointerCapture(e.pointerId);
      const p = pointFromEvent(e);
      offset.x = p.x - parseFloat(logoImage.getAttribute('x'));
      offset.y = p.y - parseFloat(logoImage.getAttribute('y'));
    });
    svg.addEventListener('pointermove', (e)=>{
      if(!dragging) return; const p = pointFromEvent(e);
      logoPos.x = Math.max(120, Math.min(300, p.x - offset.x));
      logoPos.y = Math.max(110, Math.min(280, p.y - offset.y));
      setLogoPosition(logoPos);
    });
    window.addEventListener('pointerup', ()=>{ dragging=false; });

    // Redimensionar logo com roda do mouse (sobre o logo)
    logoImage.addEventListener('wheel', (e)=>{
      e.preventDefault();
      const delta = Math.sign(e.deltaY);
      const factor = delta>0 ? 0.9 : 1.1;
      logoPos.w = Math.max(20, Math.min(160, logoPos.w * factor));
      logoPos.h = logoPos.w; // quadrado
      setLogoPosition(logoPos);
    });

    // Textura
    const textureSel = byId('texture');
    textureSel.addEventListener('change', e=> setTexture(e.target.value));
    setTexture('none');

    // Download PNG (converte SVG -> PNG via canvas)
    const btnDownload = byId('downloadPng');
    btnDownload.addEventListener('click', async ()=>{
      const xml = new XMLSerializer().serializeToString(svg);
      const svgBlob = new Blob([xml], {type: 'image/svg+xml;charset=utf-8'});
      const url = URL.createObjectURL(svgBlob);
      const img = new Image();
      const canvas = document.createElement('canvas');
      canvas.width = 1200; canvas.height = 1200; // alta resolução
      const ctx = canvas.getContext('2d');
      // fundo
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      await new Promise((res)=>{ img.onload=()=>res(); img.src=url; });
      ctx.drawImage(img, 60, 60, 1080, 1080);
      URL.revokeObjectURL(url);
      const a = document.createElement('a');
      a.download = 'kimono-fightlab.png';
      a.href = canvas.toDataURL('image/png');
      a.click();
    });
  </script>
</body>
</html>
