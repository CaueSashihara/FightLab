<script>
  function resize(){ const c=qs('#stage'); const rect=c.getBoundingClientRect(); const w=rect.width||c.clientWidth||640; const h=rect.height||c.clientHeight||520; if(!camera||!renderer) return; camera.aspect=w/h; camera.updateProjectionMatrix(); renderer.setSize(w,h,false); }
  function animate(){ requestAnimationFrame(animate); controls&&controls.update(); renderer&&scene&&camera&&renderer.render(scene,camera); }
  function init3D(){
    const canvas=qs('#stage');
    renderer=new THREE.WebGLRenderer({canvas,antialias:true,preserveDrawingBuffer:true,alpha:true});
    renderer.setPixelRatio(Math.min(window.devicePixelRatio||1,2));
    scene=new THREE.Scene(); scene.background=new THREE.Color(0x0a0a0a);
    camera=new THREE.PerspectiveCamera(45,1,0.1,
