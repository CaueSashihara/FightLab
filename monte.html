<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FightLab 3D - Configurador de Kimono</title>
  <style>
    html, body { margin:0; height:100%; background:#0c0f13; color:#fff; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    #stage { position:fixed; inset:0; display:block; }
    #fab { position: fixed; right: 24px; bottom: 24px; width: 56px; height: 56px; border-radius: 50%; background:#00ff88; color:#0b1a13; border:none; cursor:pointer; box-shadow: 0 10px 30px rgba(0,255,136,.4); font-weight: 800; }
    #wow { position:fixed; left:24px; top:24px; padding:8px 12px; border-radius:10px; background: linear-gradient(135deg, #111826, #0b1220); border:1px solid rgba(255,255,255,.08); display:flex; gap:10px; align-items:center; }
    #wow b { color:#00ff88; letter-spacing:.5px; }
    dialog#controls { width:min(92vw, 740px); border:none; border-radius:16px; padding:0; overflow:hidden; background: rgba(16,20,28,.9); color:#fff; backdrop-filter: blur(14px) saturate(1.2); box-shadow: 0 30px 80px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.06); }
    #controls::backdrop { background: rgba(0,0,0,.45); backdrop-filter: blur(4px); }
    .controls-head { display:flex; justify-content:space-between; align-items:center; padding:16px 20px; background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,0)); border-bottom:1px solid rgba(255,255,255,.06); }
    .controls-body { display:grid; grid-template-columns: 1fr 1fr; gap:18px; padding:18px 20px 20px; }
    .group { border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:14px; background:rgba(255,255,255,.02); }
    .group h3 { margin:0 0 10px; font-size:14px; letter-spacing:.3px; color:#9ec9b7; }
    .swatches { display:flex; flex-wrap:wrap; gap:10px; }
    .swatch { width:36px; height:36px; border-radius:8px; border:2px solid rgba(255,255,255,.7); cursor:pointer; box-shadow: inset 0 0 0 2px rgba(0,0,0,.25); }
    .swatch.active { outline: 3px solid #00ff88; outline-offset: 2px; }
    select, button, .file { width:100%; padding:10px 12px; border-radius:10px; background:#121a22; color:#fff; border:1px solid rgba(255,255,255,.08); }
    button.primary { background:#00ff88; color:#08221a; border:none; font-weight:800; }
    .row { display:flex; gap:10px; }
    .hint { opacity:.65; font-size:12px; margin-top:6px; }
    #toast { position:fixed; left:50%; bottom:24px; transform:translateX(-50%) translateY(20px); background:#10161f; color:#eafff6; padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08); opacity:0; transition:.35s ease; }
    #toast.show { opacity:1; transform:translateX(-50%) translateY(0); }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
  <canvas id="stage"></canvas>
  <div id="wow">✨ <b>FightLab WOW</b> – Configure seu kimono em 3D</div>
  <button id="fab" title="Personalizar">⚙️</button>
  <dialog id="controls">
    <div class="controls-head">
      <div>
        <div style="font-weight:800">Personalize seu Kimono</div>
        <div class="hint">Cores, tecido, patches e snapshot</div>
      </div>
      <button id="close">✕</button>
    </div>
    <div class="controls-body">
      <div class="group">
        <h3>Cor Base</h3>
        <div class="swatches" id="base-swatches"></div>
        <div class="hint">Transição suave de cor com brilho sutil</div>
      </div>
      <div class="group">
        <h3>Cor do Detalhe</h3>
        <div class="swatches" id="trim-swatches"></div>
        <div class="hint">Gola, costuras e punhos</div>
      </div>
      <div class="group">
        <h3>Tecido</h3>
        <select id="fabric">
          <option value="pearl">Pearl Weave (leve)</option>
          <option value="gold">Gold Weave (médio)</option>
          <option value="honey">Honeycomb (texturizado)</option>
        </select>
        <div class="hint">Ajusta rugosidade e textura estilizada</div>
      </div>
      <div class="group">
        <h3>Patch/Logo</h3>
        <div class="row">
          <select id="patchPreset">
            <option value="none">Sem patch</option>
            <option value="fightlab">FightLab</option>
            <option value="circle">Círculo</option>
            <option value="kanji">Kanji</option>
          </select>
          <label class="file" style="display:flex;align-items:center;justify-content:center;cursor:pointer;">
            Upload PNG
            <input id="patchFile" type="file" accept="image/png" style="display:none;"/>
          </label>
        </div>
        <div class="hint">Aplicado no peito e costas com leve relevo</div>
      </div>
      <div class="group">
        <h3>Visualização</h3>
        <div class="row">
          <button id="spin" class="primary">Girar 360°</button>
          <button id="pose">Pose dinâmica</button>
        </div>
        <div class="row" style="margin-top:10px;">
          <button id="snapshot">Snapshot/Download</button>
          <button id="reset">Reset</button>
        </div>
      </div>
    </div>
  </dialog>
  <div id="toast">Imagem baixada!</div>
  <script>
  const canvas = document.getElementById('stage');
  const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true, preserveDrawingBuffer:true });
  renderer.setPixelRatio(Math.min(2, window.devicePixelRatio||1));
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.outputColorSpace = THREE.SRGBColorSpace;
  const scene = new THREE.Scene();
  scene.fog = new THREE.FogExp2(0x0c0f13, 0.02);
  const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 100);
  camera.position.set(2.6, 1.7, 3.2);
  const hemi = new THREE.HemisphereLight(0xd9fff0, 0x0b0f14, 1.0); scene.add(hemi);
  const key = new THREE.DirectionalLight(0xffffff, 2.2); key.position.set(3,4,2); key.castShadow = true; scene.add(key);
  const rim = new THREE.DirectionalLight(0x00ff88, 0.9); rim.position.set(-3, 2, -2); scene.add(rim);
  const ground = new THREE.Mesh(new THREE.PlaneGeometry(20,20), new THREE.MeshStandardMaterial({color:0x0b1016, metalness:.2, roughness:.9}));
  ground.rotation.x = -Math.PI/2; ground.position.y = -0.01; ground.receiveShadow = true; scene.add(ground);
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true; controls.dampingFactor = .05; controls.minDistance = 2; controls.maxDistance = 6; controls.maxPolarAngle = Math.PI*0.49;
  const group = new THREE.Group(); scene.add(group);
  const texLoader = new THREE.TextureLoader();
  const noise = texLoader.load('https://raw.githubusercontent.com/emmelleppi/public-assets/main/textures/noise-soft-512.png'); noise.wrapS = noise.wrapT = THREE.RepeatWrapping; noise.repeat.set(6,6);
  const baseMat = new THREE.MeshPhysicalMaterial({ color: 0x111926, roughness: .65, metalness: .05, sheen: 1.0, sheenColor: new THREE.Color('#cfeee5'), sheenRoughness:.5, clearcoat:.2, clearcoatRoughness:.6, map: null });
  const trimMat = new THREE.MeshStandardMaterial({ color: 0x00ff88, roughness: .4, metalness: .1 });
  const body = new THREE.Group(); group.add(body);
  const torso = new THREE.Mesh(new THREE.BoxGeometry(1.1, 1.1, 0.5, 20,20,10), baseMat); torso.castShadow = true; torso.position.y = 1.2; torso.scale.set(1.05,1.1,1.0); body.add(torso);
  const collar = new THREE.Mesh(new THREE.BoxGeometry(1.2, .12, .55), trimMat); collar.position.set(0,1.7,0.02); body.add(collar);
  const sleeveL = new THREE.Mesh(new THREE.CylinderGeometry(.18,.22,.9, 24), baseMat); sleeveL.rotation.z = Math.PI/2.2; sleeveL.position.set(-.88,1.25,0); body.add(sleeveL);
  const sleeveR = sleeveL.clone(); sleeveR.position.x *= -1; body.add(sleeveR);
  const cuffL = new THREE.Mesh(new THREE.CylinderGeometry(.18,.18,.16, 24), trimMat); cuffL.rotation.z = sleeveL.rotation.z; cuffL.position.copy(sleeveL.position).add(new THREE.Vector3(.0,-.42,0)); body.add(cuffL);
  const cuffR = cuffL.clone(); cuffR.position.x *= -1; body.add(cuffR);
  const belt = new THREE.Mesh(new THREE.TorusKnotGeometry(.32,.055, 80,16, 2,3), trimMat); belt.position.set(0,.85,.28); belt.rotation.x = Math.PI/2; body.add(belt);
  const pants = new THREE.Mesh(new THREE.BoxGeometry(.9, 1.0, .35, 4,4,2), baseMat); pants.position.set(0, .35, 0); pants.castShadow = true; body.add(pants);
  const patchMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent:true, opacity:1, depthWrite:false, map:null });
  const patchFront = new THREE.Mesh(new THREE.PlaneGeometry(0.34,0.34), patchMat.clone()); patchFront.position.set(.38, 1.35, .255); body.add(patchFront);
  const patchBack = new THREE.Mesh(new THREE.PlaneGeometry(0.6,0.6), patchMat.clone()); patchBack.position.set(0, 1.38, -0.255); patchBack.rotation.y = Math.PI; body.add(patchBack);
  let spinMode = false, poseTime = 0, autoFloat = true;
  let t = 0; const clock = new THREE.Clock();
  function animate(){
    const dt = clock.getDelta(); t += dt; controls.update();
    if(autoFloat){ group.position.y = Math.sin(t*1.2)*0.03; group.rotation.y += 0.0008; }
    if(spinMode){ group.rotation.y += 0.02; }
    if(poseTime>0){ const k = Math.sin(poseTime*3); body.rotation.z = k*0.08; body.rotation.x = Math.sin(poseTime*2)*0.03; poseTime -= dt; if(poseTime<=0){ body.rotation.set(0,0,0); } }
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  }
  requestAnimationFrame(animate);
  window.addEventListener('resize', ()=>{ renderer.setSize(innerWidth, innerHeight); camera.aspect = innerWidth/innerHeight; camera.updateProjectionMatrix(); });
  function buildSwatches(el, list, cb) { list.forEach((c,i)=>{ const s = document.createElement('button'); s.className='swatch'; s.style.background = c; s.title = c; if(i===0) s.classList.add('active'); s.onclick = ()=>{ el.querySelectorAll('.swatch').forEach(x=>x.classList.remove('active')); s.classList.add('active'); cb(c); }; el.appendChild(s); }); }
  const baseColors = ['#0f172a','#0b1a13','#101e33','#1f2937','#2b2b2b','#d9d9d9','#ffffff','#123d2a','#1e90ff','#8b5cf6','#dc2626','#f59e0b'];
  const trimColors = ['#00ff88','#ff3366','#ffd166','#60a5fa','#a78bfa','#38bdf8','#e11d48','#f97316','#10b981','#94a3b8','#111827'];
  buildSwatches(document.getElementById('base-swatches'), baseColors, (c)=> tweenColor(baseMat.color, new THREE.Color(c)));
  buildSwatches(document.getElementById('trim-swatches'), trimColors, (c)=> tweenColor(trimMat.color, new THREE.Color(c)));
  function tweenColor(target, to, dur=0.6) { const from = target.clone(); let k=0; const id = setInterval(()=>{ k+=16/(dur*1000); const e = easeOutCubic(Math.min(1,k)); target.lerpColors(from, to, e); }, 16); setTimeout(()=>clearInterval(id), dur*1000+30); }
  function easeOutCubic(x){ return 1 - Math.pow(1 - x, 3); }
  const fabricSel = document.getElementById('fabric');
  fabricSel.addEventListener('change', e=>{ const v = e.target.value; let r=.6, n=6; if(v==='pearl'){r=.55;n=8;} if(v==='gold'){r=.5;n=5;} if(v==='honey'){r=.45;n=10;} noise.repeat.set(n,n); baseMat.roughness=r; baseMat.map=noise; baseMat.needsUpdate=true; });
  fabricSel.dispatchEvent(new Event('change'));
  const patchPreset = document.getElementById('patchPreset');
  const patchFile = document.getElementById('patchFile');
  function setPatch(map){ [patchFront, patchBack].forEach(p=>{ p.material.map = map || null; p.material.needsUpdate = true; p.visible = !!map; }); }
  patchPreset.addEventListener('change', ()=>{ const v = patchPreset.value; if(v==='none'){ setPatch(null); return; } const img = new Image(); img.crossOrigin='anonymous'; img.onload = ()=>{ const tex = new THREE.CanvasTexture(img); tex.colorSpace = THREE.SRGBColorSpace; setPatch(tex); }; if(v==='fightlab'){ img.src='https://raw.githubusercontent.com/CaueSashihara/FightLab/main/assets/fightlab.png'; } else if(v==='circle'){ img.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22600%22 height=%22600%
